# パスワード付きZIP圧縮ツール for macOS

Finderの右クリックメニューからパスワード付きZIP圧縮を実行できる Automator クイックアクションです。
追加ソフトのインストールは不要で、macOS 標準機能のみで動作します。

## 動作環境

- macOS Monterey (12.0) 以降
- Python 3（Xcode Command Line Tools に含まれます）

## インストール

ターミナルで以下を実行します。

```bash
cd ~/Work/password-zip-tool
./install.sh
```

### メニューに表示されない場合

1. Finder を再起動する
   ```bash
   killall Finder
   ```
2. **システム設定** → **プライバシーとセキュリティ** → **機能拡張** → **Finder** で「パスワード付きZIP圧縮」が有効になっているか確認
3. 上記で解決しない場合は、一度ログアウト／ログインしてください

### 初回実行時の注意

オートメーションのアクセス許可ダイアログが表示される場合があります。「OK」を押して許可してください。

## 使い方

1. Finder でファイルまたはフォルダを右クリック
2. **「クイックアクション」** → **「パスワード付きZIP圧縮」** を選択
3. パスワード入力ダイアログが表示されるので、パスワードを入力して **「圧縮」** を押す
4. 確認のためパスワードを再入力して **「確認」** を押す
5. 同じフォルダにパスワード付き `.zip` ファイルが作成される

複数のファイル／フォルダを選択して圧縮することもできます。その場合、`アーカイブ.zip` というファイル名で作成されます。

## 機能

| 機能 | 説明 |
|------|------|
| パスワード2回入力 | 確認入力によりタイプミスを防止 |
| パスワードのマスク表示 | 入力内容は `●●●` で表示される |
| 重複ファイル名の自動回避 | 同名の ZIP が既にある場合は連番を付与（例: `file 1.zip`） |
| `.DS_Store` 自動除外 | macOS 固有の隠しファイルを ZIP に含めない |
| macOS 通知 | 圧縮の開始時・完了時に通知を表示 |

## 出力ファイル名のルール

| 選択対象 | 出力ファイル名 |
|----------|----------------|
| 単一ファイル（例: `報告書.pdf`） | `報告書.zip` |
| 単一フォルダ（例: `プロジェクト`） | `プロジェクト.zip` |
| 複数ファイル／フォルダ | `アーカイブ.zip` |

## ファイル構成

```
password-zip-tool/
├── README.md          ← このファイル
├── password-zip.sh    ← 圧縮処理のシェルスクリプト
├── install.sh         ← インストーラー
└── uninstall.sh       ← アンインストーラー
```

ワークフローは以下にインストールされます。

```
~/Library/Services/パスワード付きZIP圧縮.workflow/
```

## アンインストール

```bash
cd ~/Work/password-zip-tool
./uninstall.sh
```

## 技術仕様

- **圧縮方式**: ZIP（macOS 標準の `zip` コマンドを使用）
- **暗号化**: ZipCrypto（`zip -P` オプション）
- **ダイアログ**: AppleScript（`osascript`）で表示
- **ワークフロー**: Automator クイックアクション（`~/Library/Services/` に配置）
